# 基于深度学习的图像风格迁移系统

![图像风格迁移系统](static/img/styles/vangogh.jpg)

## 项目介绍

这是一个基于深度学习技术的图像风格迁移系统，支持三种核心算法路径：
快速风格迁移（基于预训练模型，适合实时处理）
神经风格迁移（基于 VGG19 特征提取，效果更优但耗时较长）
简化风格迁移（纯图像处理算法，适合快速预览）
系统提供多风格融合、参数实时调节、可视化分析等功能，技术栈严格对齐代码实现。

### 主要特点

- **多种风格选择**：提供多种预定义艺术风格，包括梵高、毕加索、水墨画等
- **实时预览**：调整参数时可实时查看效果变化
- **参数调节**：可调整风格强度、内容保留度、色彩增强等参数
- **多风格融合**：支持多达3种风格的混合迁移，可调整各风格权重
- **可视化分析**：提供风格特性雷达图和效果预测热力图
- **用户系统**：支持用户注册、登录、历史记录管理
- **作品分享**：可生成分享链接，分享您的创作
- **管理后台**：提供用户管理和风格模型管理功能

## 系统架构

该系统采用前后端分离架构，使用Flask作为后端框架，HTML/CSS/JavaScript构建前端界面，MySQL作为数据库存储。

### 核心算法：
快速迁移：TransformerNet 网络（含残差块）
神经迁移：VGG19 特征提取 + 内容 / 风格损失（Gram 矩阵）
简化迁移：PIL/OpenCV 混合操作（色彩调整、笔触模拟）

### 技术栈

- **前端**：HTML, CSS, JavaScript
- **后端**：Flask (Python)
- **数据库**：MySQL
- **深度学习框架**：PyTorch
- **其他**：Plotly.js (数据可视化)

## 项目结构

```
/portrait/
  /static/                  # 静态资源目录
    /css/                   # CSS样式文件
    /js/                    # JavaScript文件
    /img/                   # 图片资源
      /styles/              # 风格预览图
      /avatars/             # 用户头像
    /uploads/               # 用户上传图片
      /originals/           # 原始图片
      /results/             # 处理结果
      /comparisons/         # 对比图
    /models/                # 预训练模型文件
  /templates/               # HTML模板文件
    /admin/                 # 管理员页面模板
  /models/                  # 风格迁移算法模块
    /pretrained/            # 预训练模型
  /database/                # 数据库文件
  /config/                  # 配置文件
  app.py                    # 主应用程序
  requirements.txt          # 依赖包列表
```

## 功能模块说明

### 1. 用户交互模块

#### 图片上传功能

- 支持JPG/PNG格式图片上传
- 文件大小限制为10MB
- 支持拖拽上传和文件选择器

#### 风格选择面板

- 提供10种预定义艺术风格
- 每种风格配有预览图片和简要描述
- 支持单选或多选(用于多风格融合)

#### 参数调节组件

- 风格强度滑动条 (0-100%)
- 内容保留度滑动条 (0-100%)
- 色彩增强开关

#### 预览窗口

- 显示风格迁移结果的实时预览
- 支持缩放和对比功能
- 提供原图与处理结果的对比视图

#### 结果下载功能
 提供下载按钮，支持下载以下内容：
 原图 + 风格迁移图的对比存档（拼接成一张图片）。
 单独下载风格迁移图。

### 2. 核心算法模块

#### 快速风格迁移（fast_transfer.py）
架构：
下采样层（3 层卷积）→ 5 个残差块 → 上采样层（3 层转置卷积）
激活函数：ReLU + Sigmoid（输出归一化至 [0,1]）
性能：GPU 加速下 512px 图像处理≈50ms，仅支持单风格

#### 神经风格迁移（neural_style.py）
原理：
VGG19 提取特征，计算内容损失（MSE）与风格损失（Gram 矩阵 MSE）
L-BFGS 优化器迭代更新输入图像
多风格融合：加权多个风格的 Gram 矩阵损失，支持≤3 种风格

#### 简化风格迁移（simplified_transfer.py）
纯图像处理：
梵高：HSV 色彩调整 + 漩涡笔触
毕加索：几何分割 + 边缘增强
水墨：阈值化 + 宣纸纹理
多风格融合：按顺序应用风格，线性混合结果（如weight1*style1 + weight2*style2）

#### 可视化分析
风格特性雷达图：
维度：笔触、色彩、纹理、对比度、构图（0-1.0 分值）
接口：/api/style_radar_data 返回 Plotly 格式数据
效果预测热力图：
横轴：内容保留度，纵轴：风格强度，标注推荐参数点
接口：/api/style_effect_prediction 模拟生成数据

#### 多风格融合实现
- **融合类型**：神经风格融合
- **实现文件**：neural_style.py	
- **技术细节**：基于 VGG19 特征提取器，对每个风格计算独立的 Gram 矩阵损失
通过weights参数加权求和风格损失（权重总和需为 1）
使用 L-BFGS 优化器迭代混合内容与多风格特征
- **技术细节**：≤3
- **性能特点**：单卡处理耗时约 10-30 分钟

- **融合类型**：简化算法融合 
- **实现文件**：simplified_transfer.py 
- **技术细节**：按顺序应用风格处理逻辑（如梵高→毕加索），结果通过Image.blend线性混合
支持自定义风格权重（如weight1*style1 + weight2*style2） 
c：≤3 
- **性能特点**:实时处理（<1秒）

### 3. 系统管理模块

#### 用户管理

- 用户注册与登录
- 个人中心 - 查看历史记录
- 作品管理 - 删除或分享作品

#### 管理员功能

- 用户管理 - 禁用/启用用户
- 风格模型管理 - 上传、编辑、删除风格模型

#### 数据存储

- 用户信息表
- 上传历史表
- 处理结果表
- 风格模型表

## 安装与运行

### 系统要求

- Python 3.9+
- 8GB+ RAM
- (可选) NVIDIA GPU with CUDA支持

### 安装步骤

1. 克隆项目代码

```bash
git clone [项目仓库URL]
cd portrait
```

2. 安装依赖包

```bash
pip install -r requirements.txt
```

3. 配置数据库

```bash
MySQL 
# 编辑 config/db_config.py 配置数据库信息
# 运行: python setup_mysql_db.py
```

4. 运行应用

```bash
python app.py
```

5. 访问系统
   打开浏览器，访问 http://localhost:5000

## 使用指南

### 基本使用流程

1. **上传图片**：点击上传区域或拖放图片到指定区域
2. **选择风格**：从风格面板中选择一种或多种艺术风格
3. **调整参数**：根据需要调整风格强度、内容保留度等参数
4. **查看预览**：实时查看风格迁移效果
5. **下载结果**：点击下载按钮保存处理结果
6. **分享作品**：点击分享按钮生成分享链接

### 高级功能

- **多风格融合**：选择多个风格并调整各自权重实现风格混合
- **参数优化**：参考风格效果预测热力图找到最佳参数组合
- **风格分析**：通过风格特性雷达图了解不同风格的主要特点

## 开发者文档

### API接口说明

#### 图片上传

- **URL**: `/upload`
- **方法**: POST
- **参数**: 图片文件(multipart/form-data)
- **返回**: 成功上传的图片信息(文件名、预览URL等)

#### 风格处理

- **URL**: `/process`
- **方法**: POST
- **参数**: 原图文件名、选择的风格、参数设置(JSON)
- **返回**: 处理结果图片URL

#### 获取风格特性雷达图

- **URL**: `/api/style_radar_data`
- **方法**: POST
- **参数**: 风格名称(JSON)
- **返回**: 雷达图数据(JSON)

#### 获取风格效果预测

- **URL**: `/api/style_effect_prediction`
- **方法**: POST
- **参数**: 风格名称或多风格组合(JSON)
- **返回**: 热力图数据(JSON)

### 数据库结构

- **users表**: 存储用户信息
- **user_uploads表**: 记录用户上传的图片
- **user_results表**: 存储风格迁移结果
- **styles表**: 存储风格模型信息

#### 代码贡献指南
- **新增风格支持**
- **算法层**： 
- 快速迁移：在fast_transfer.py中添加预训练模型路径 
- 简化迁移：在simplified_transfer.py中实现apply_<new_style>函数 
- 可视化层： 在/api/style_radar_data中更新style_features字典;在/api/style_effect_prediction中定义新风格的最佳参数 
- **前端层**：
- 添加风格预览图至static/img/styles/ 
- 更新前端界面的风格选择面板与参数逻辑 
- **调试**
- 后端日志位于app.log，包含请求记录与错误信息 
- 前端通过浏览器控制台（F12）查看 API 请求状态与 Plotly 渲染日志
© 2025 基于深度学习的图像风格迁移系统
